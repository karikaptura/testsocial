{% extends 'base.html' %}

{% load static %}

{% block content %}
<div class="profile-container">
    <!-- –í–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å –ø—Ä–æ—Ñ–∏–ª—è -->
    <div class="profile-header">
        <div class="profile-header-left">
            <!-- –ê–≤–∞—Ç–∞—Ä -->
            <img src="{% if profile.avatar %}{{ profile.avatar.url }}{% else %}/static/default-avatar.png{% endif %}" 
                 alt="–ê–≤–∞—Ç–∞—Ä" class="profile-avatar" id="profile-avatar">

            <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∞–≤–∞—Ç–∞—Ä–∞ -->
            <div id="avatar-modal" class="modal">
                <span class="close">&times;</span>
                <img class="modal-content" id="avatar-modal-img">
            </div>

            <div class="profile-info">
                <h1>{{ profile.user.get_full_name|default:profile.user.username }}</h1>
                <p>{{ profile.bio|default:"–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç" }}</p>
                <p><strong>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</strong> {{ profile.birth_date|date:"d M Y"|default:"–ù–µ —É–∫–∞–∑–∞–Ω–∞" }}</p>
                <p><strong>–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</strong> {{ profile.location|default:"–ù–µ —É–∫–∞–∑–∞–Ω–æ" }}</p>
                <p><strong>–ò–Ω—Ç–µ—Ä–µ—Å—ã:</strong> {{ profile.interests|default:"–ù–µ —É–∫–∞–∑–∞–Ω—ã" }}</p>
            </div>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
    <div class="profile-actions">
        {% if request.user == profile.user %}
            <!-- –ö–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è -->
            <a href="{% url 'edit_profile' profile.user.username %}" class="button edit-profile-button">
                –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
            </a>
        {% else %}
            <!-- –ö–Ω–æ–ø–∫–∏ –¥–ª—è –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
            {% if is_friend %}
                <button class="button disabled" disabled>–í—ã –¥—Ä—É–∑—å—è</button>
            {% elif sent_request %}
                <button class="button disabled" disabled>–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω</button>
            {% else %}
                <a href="{% url 'send_friend_request' profile.user.id %}" class="button add-friend-button">
                    –î–æ–±–∞–≤–∏—Ç—å –≤ –¥—Ä—É–∑—å—è
                </a>
            {% endif %}
            {% if conversation_id %}
                <a href="{% url 'conversation_detail' conversation_id %}" class="button message-button">
                    –ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
                </a>
            {% else %}
                <a href="{% url 'start_conversation' profile.user.id %}" class="button message-button">
                    –ù–∞—á–∞—Ç—å –¥–∏–∞–ª–æ–≥
                </a>
            {% endif %}
            {% if is_friend %}
                <a href="{% url 'remove_friend' profile.user.id %}" class="button remove-friend-button">
                    –£–¥–∞–ª–∏—Ç—å –∏–∑ –¥—Ä—É–∑–µ–π
                </a>
            {% endif %}
        {% endif %}
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∏ -->
    <div class="tabs-container">
        <div class="tabs">
            <button class="tab-button active" data-tab="friends-tab">–î—Ä—É–∑—å—è</button>
            <button class="tab-button" data-tab="groups-tab">–ì—Ä—É–ø–ø—ã</button>
            <button class="tab-button" data-tab="music-tab">–ú—É–∑—ã–∫–∞</button>
            <button class="tab-button" data-tab="photos-tab">–§–æ—Ç–æ</button>
            <button class="tab-button" data-tab="videos-tab">–í–∏–¥–µ–æ</button>
        </div>

        <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–∫–∏ "–î—Ä—É–∑—å—è" -->
        <div id="friends-tab" class="tab-content active">
            <h2>–î—Ä—É–∑—å—è ({{ profile.friends.count }})</h2>
            <ul class="friends-list">
                {% for friend in profile.friends.all %}
                    <li class="friend-item">
                        <a href="{% url 'view_profile' friend.user.username %}">
                            <img src="{% if friend.avatar %}{{ friend.avatar.url }}{% else %}/static/default-avatar.png{% endif %}" 
                                 alt="{{ friend.user.username }}" class="friend-avatar">
                            <span>{{ friend.user.get_full_name|default:friend.user.username }}</span>
                        </a>
                    </li>
                {% empty %}
                    <p>–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–∫–∞ –Ω–µ—Ç –¥—Ä—É–∑–µ–π.</p>
                {% endfor %}
            </ul>
        </div>

        <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–∫–∏ "–ì—Ä—É–ø–ø—ã" -->
        <div id="groups-tab" class="tab-content">
            <h2>–ì—Ä—É–ø–ø—ã</h2>
            <p>–°–∫–æ—Ä–æ –∑–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è –≥—Ä—É–ø–ø—ã.</p>
        </div>

        <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–∫–∏ "–ú—É–∑—ã–∫–∞" -->
        <div id="music-tab" class="tab-content">
            <h2>–ú—É–∑—ã–∫–∞</h2>
            <p>–°–∫–æ—Ä–æ –∑–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –º—É–∑—ã–∫–∞.</p>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ "–§–æ—Ç–æ" -->
        <div id="photos-tab" class="tab-content">
            <h2>–§–æ—Ç–æ</h2>
            {% if request.user == profile.user %}
                <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ–æ—Ç–æ -->
                <form method="POST" enctype="multipart/form-data" action="{% url 'add_photo' %}" class="add-media-form">
                    {% csrf_token %}
                    <input type="file" name="photo" accept="image/*" required>
                    <button type="submit" class="button">–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ</button>
                </form>
            {% endif %}
            {% if photos %}
                <div class="photos-grid">
                    {% for photo in photos %}
                        <div class="photo-item">
                            <img src="{{ photo.file.url }}" alt="–§–æ—Ç–æ">
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ñ–æ—Ç–æ.</p>
            {% endif %}
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ "–í–∏–¥–µ–æ" -->
        <div id="videos-tab" class="tab-content">
            <h2>–í–∏–¥–µ–æ</h2>
            {% if request.user == profile.user %}
                <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–µ–æ -->
                <form method="POST" enctype="multipart/form-data" action="{% url 'add_video' %}" class="add-media-form">
                    {% csrf_token %}
                    <input type="file" name="video" accept="video/*" required>
                    <button type="submit" class="button">–î–æ–±–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ</button>
                </form>
            {% endif %}
            {% if videos %}
                <div class="videos-grid">
                    {% for video in videos %}
                        <div class="video-item">
                            <video controls>
                                <source src="{{ video.file.url }}" type="video/mp4">
                                –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
                            </video>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–∏–¥–µ–æ.</p>
            {% endif %}
        </div>


    {% if request.user == profile.user %}
        <div class="create-post-form">
            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                
                <!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞ -->
                <textarea name="content" placeholder="–ß—Ç–æ —É –≤–∞—Å –Ω–æ–≤–æ–≥–æ?"></textarea>

                <!-- –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é –¥–ª—è –≤–ª–æ–∂–µ–Ω–∏–π -->
                <div class="file-attachment-menu">
                    <button type="button" class="attachment-button">
                        üìé <!-- –°–∏–º–≤–æ–ª —Å–∫—Ä–µ–ø–∫–∏ -->
                    </button>
                    <div class="attachment-menu">
                        <label for="image-input">–§–æ—Ç–æ</label>
                        <input type="file" id="image-input" name="image" accept="image/*">
                        <label for="video-input">–í–∏–¥–µ–æ</label>
                        <input type="file" id="video-input" name="video" accept="video/*">
                    </div>
                </div>

                <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
                <button type="submit" class="button">–î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å—Ç</button>
            </form>
        </div>
    {% endif %}

    <!-- –ü–æ—Å—Ç—ã -->
    <div class="profile-posts">
        <h2>–ü–æ—Å—Ç—ã</h2>
        <div class="posts-grid">
            {% for post in profile.user.posts.all %}
                <div class="post-card">
                    <p>{{ post.content }}</p>
                    {% if post.image %}
                        <img src="{{ post.image.url }}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" class="post-image">
                    {% endif %}
                    {% if post.video %}
                        <video controls class="post-video">
                            <source src="{{ post.video.url }}" type="video/mp4">
                            –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
                        </video>
                    {% endif %}
                    <p class="post-date">{{ post.created_at|date:"d M Y H:i" }}</p>

                    {% if request.user == profile.user %}
                        <a href="{% url 'delete_post' post.id %}" class="button delete-button" 
                        onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø–æ—Å—Ç?');">
                            –£–¥–∞–ª–∏—Ç—å
                        </a>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    </div>
</div>

<script src="{% static 'js/profile.js' %}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');

        tabButtons.forEach(button => {
            button.addEventListener('click', function () {
                const targetTab = this.getAttribute('data-tab');

                // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));

                // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–Ω–æ–ø–∫–µ –∏ –≤–∫–ª–∞–¥–∫–µ
                this.classList.add('active');
                document.getElementById(targetTab).classList.add('active');
            });
        });
    });
</script>
{% endblock %}
